name: deploy terraform code to aws

on:
    push:
          branches: 
            - main

jobs:
    deploy:
          runs-on: ubuntu-latest

          steps:
          - name: Checkout the code
            uses: actions/checkout@v5.0.0

          - name: Configure AWS Credentials
            uses: aws-actions/configure-aws-credentials@v5.1.0
            with:
              aws-access-key-id: ${{secrets.AWS_ACCESS_KEY_ID}}
              aws-secret-access-key: ${{secrets.AWS_SECRET_ACCESS_KEY}}
              aws-region: us-east-1

          - name: HashiCorp - Setup Terraform
            uses: hashicorp/setup-terraform@v2.0.3

          - name: initialize Terraform
            run: terraform init

          - name: validate terraform code
            run: terraform validate

          - name: plan Terraform
            run: terraform plan

          - name: deploy terraform to aws
            run: terraform apply --auto-approve